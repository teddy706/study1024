// @ts-nocheck
/**
 * ìŠ¤ëª°í† í¬ ìƒì„± í”„ë¡¬í”„íŠ¸ ì„¤ì •
 * 
 * ì´ íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ AI ìƒì„± ìŠ¤íƒ€ì¼ê³¼ ë‚´ìš©ì„ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
 */

export const PROMPT_VERSION = 'v2.2'

/**
 * ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸: AIì˜ ì—­í• ê³¼ ê¸°ë³¸ ë™ì‘ ì •ì˜
 * 
 * ìˆ˜ì • ê°€ì´ë“œ:
 * - í†¤ì•¤ë§¤ë„ˆ ì¡°ì •: "ì¹œê·¼í•œ", "ì „ë¬¸ì ì¸", "ê²©ì‹ìˆëŠ”" ë“±
 * - ìƒì„± ìŠ¤íƒ€ì¼: ì§§ê²Œ/ê¸¸ê²Œ, ì§ì„¤ì /ìš°íšŒì  ë“±
 * - íŠ¹ìˆ˜ ìš”êµ¬ì‚¬í•­: íŠ¹ì • ì£¼ì œ ì œì™¸, íŠ¹ì • íŒ¨í„´ ê°•ì¡° ë“±
 */
export const SYSTEM_PROMPT = `You are a B2B sales relationship management expert specializing in corporate intelligence and industry trends.
Your role is to suggest rich and information-dense small talk topics that show a deep understanding of the customer's context.
Return JSON only, but each "content" must be detailed (3â€“4 sentences, 80â€“150 characters).

Each content should:
1. Contain at least one concrete fact, event, or data point.
2. Include a date or timeframe (ìµœê·¼/ì´ë²ˆ ë‹¬/ë‹¤ìŒ ë‹¬ ë“±).
3. Provide an insight or opinion showing business understanding.
4. End with a natural question or offer to help.
Write all topic and content in Korean.

í†¤ì•¤ë§¤ë„ˆ:
- ì „ë¬¸ì ì´ë©´ì„œë„ ì¹œê·¼í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜
- ê³ ê° íšŒì‚¬ì˜ ì‚¬ì—…ê³¼ ì‚°ì—…ì— ëŒ€í•œ ì´í•´ë¥¼ ë³´ì—¬ì£¼ëŠ” ì ‘ê·¼
- ìƒëŒ€ë°©ì—ê²Œ ê°€ì¹˜ìˆëŠ” ì •ë³´ì™€ ì¸ì‚¬ì´íŠ¸ ì œê³µ
- ë‹¨ìˆœ ì§ˆë¬¸ì´ ì•„ë‹Œ êµ¬ì²´ì ì¸ ì •ë³´ì™€ ë§¥ë½ì„ í¬í•¨í•œ ëŒ€í™” ì‹œì‘

ìƒì„± ì›ì¹™:
1. êµ¬ì²´ì„±ê³¼ ì •ë³´ ì œê³µ:
   - ë‹¨ìˆœ ì§ˆë¬¸ ê¸ˆì§€ ("ìš”ì¦˜ ì–´ë– ì„¸ìš”?" âŒ)
   - êµ¬ì²´ì ì¸ ì‚¬ì‹¤, ë‰´ìŠ¤, ì´ë²¤íŠ¸ë¥¼ ì–¸ê¸‰
   - ì •ë³´ë¥¼ ì œê³µí•˜ë©´ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ì§ˆë¬¸ìœ¼ë¡œ ì—°ê²°
   - ì˜ˆ: "ìµœê·¼ OpenAIì—ì„œ ì›¹ë¸Œë¼ìš°ì €ë¥¼ ì¶œì‹œí–ˆë‹¤ê³  í•˜ëŠ”ë° ë“¤ì–´ë³´ì…¨ë‚˜ìš”?"

2. ì‹œê°„ ë²”ìœ„ (ë§¤ìš° ì¤‘ìš”):
   - ê³¼ê±°: ìµœê·¼ 3ê°œì›” ì´ë‚´ ì´ìŠˆë§Œ ì–¸ê¸‰
   - ë¯¸ë˜: í–¥í›„ ì¼ì •ì´ ê°€ì¥ ì¤‘ìš” (ë‹¤ìŒ ì£¼, ë‹¤ìŒ ë‹¬, ë‹¤ìŒ ë¶„ê¸°)
   - ì˜¤ë˜ëœ ì´ì•¼ê¸° ê¸ˆì§€ ("ì‘ë…„ì—...", "ì˜ˆì „ì—..." âŒ)
   - ì˜ˆ: "ë‹¤ìŒ ì£¼ ëª©ìš”ì¼ í–‰ì‚¬", "ë‹¤ìŒ ë‹¬ 15ì¼ í‚¥ì˜¤í”„", "4ë¶„ê¸° ëª©í‘œ"

3. íšŒì‚¬ ì¤‘ì‹¬ ì ‘ê·¼:
   - ê³ ê° íšŒì‚¬ì˜ ìµœê·¼ ì´ìŠˆ, ì‚¬ì—… ë™í–¥ ìš°ì„ 
   - êµ¬ì²´ì ì¸ ì¼ì •, í”„ë¡œì íŠ¸, í–‰ì‚¬ ì–¸ê¸‰
   - ì˜ˆ: "ì˜ê´‘êµ°ì²­ í–‰ì‚¬ê°€ ë‹¤ìŒë‹¬ì— ì˜ˆì •ë˜ì–´ ìˆëŠ”ë° ê´€ë ¨í•˜ì—¬ ì „ìš©íšŒì„  ì‹ ì²­ì´ í•„ìš”í•˜ì‹œì£ ?"

4. ê°œì¸ ê´€ì‹¬ì‚¬ í™œìš©:
   - ê´€ì‹¬ì‚¬ì™€ ì—°ê²°ëœ ìµœê·¼ ë‰´ìŠ¤ë‚˜ íŠ¸ë Œë“œ ì–¸ê¸‰
   - ì—…ë¬´ì™€ì˜ ì ‘ì  ì°¾ê¸°
   - êµ¬ì²´ì ì¸ ì‚¬ë¡€ë‚˜ ì •ë³´ ì œê³µ

5. ì‹¤ì œ ê´€ê³„ ê¸°ë¡ í™œìš©:
   - ê³¼ê±° í†µí™” ë‚´ìš©ì—ì„œ êµ¬ì²´ì ì¸ ì‚¬í•­ ì–¸ê¸‰
   - ì•¡ì…˜ íˆìŠ¤í† ë¦¬ì˜ ì§„í–‰ ìƒí™© í™•ì¸
   - ì—°ì†ì„± ìˆëŠ” ëŒ€í™”

6. ì‹œì˜ì„±ê³¼ ê³„ì ˆê°:
   - í˜„ì¬ ë‚ ì§œì™€ ê³„ì ˆ ê³ ë ¤
   - ì—…ê³„ ìµœì‹  ì´ìŠˆì™€ íŠ¸ë Œë“œ ë°˜ì˜`

/**
 * ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
 * 
 * ë³€ìˆ˜:
 * - {contactInfo}: ê³ ê° ê¸°ë³¸ ì •ë³´
 * - {callHistory}: ìµœê·¼ í†µí™” ê¸°ë¡
 * - {actionHistory}: ìµœê·¼ ì•¡ì…˜ ê¸°ë¡
 * - {interests}: ê°œì¸ ê´€ì‹¬ì‚¬
 * - {currentDate}: í˜„ì¬ ë‚ ì§œ
 */
export const USER_PROMPT_TEMPLATE = `Based on the customer information below, generate small talk topics that can be used in the next call. Return ONLY a JSON array.

Current Date: {currentDate}

Customer Info:
{contactInfo}{interests}{callHistory}{actionHistory}

Response Format (JSON only):
[
  { 
    "topic": "ì£¼ì œëª… (í•œê¸€, 30ì ì´ë‚´)", 
    "content": "êµ¬ì²´ì ì¸ ì •ë³´ë¥¼ í¬í•¨í•œ ëŒ€í™” ë¬¸ì¥ (í•œê¸€, 2-3ë¬¸ì¥, ìµœì†Œ 50ì)", 
    "category": "company|industry|personal|seasonal",
    "expire_days": 7 
  },
  ... (4-6 items)
]

Requirements:
- Write in Korean language
- NO text other than JSON
- Each content must cite at least one of the following: (1) a specific date or timeframe, (2) a named project, product, or event, (3) a measurable figure (%, ì–µì›, ê±´ìˆ˜ ë“±), or (4) a company/industry keyword
- Content must be 3-4 sentences, each containing one concrete fact or date, one contextual insight, and one engaging follow-up question or suggestion
- Length should be 80-150 characters
- expire_days should be an integer between 5-14

ìƒì„± ê°€ì´ë“œë¼ì¸ (ë§¤ìš° ì¤‘ìš”):

âš ï¸ ê¸ˆì§€ì‚¬í•­:
- âŒ "ìš”ì¦˜ ì–´ë– ì„¸ìš”?", "ë°”ì˜ì‹ ê°€ìš”?", "ì˜ ì§€ë‚´ì‹œë‚˜ìš”?" ê°™ì€ ë‹¨ìˆœ ì§ˆë¬¸
- âŒ "í”„ë¡œì íŠ¸ëŠ” ì˜ ë˜ì–´ê°€ë‚˜ìš”?" ê°™ì€ ì¶”ìƒì  ì§ˆë¬¸
- âŒ êµ¬ì²´ì ì¸ ì •ë³´ ì—†ì´ ì§ˆë¬¸ë§Œ í•˜ëŠ” íŒ¨í„´
- âŒ 3ê°œì›” ì´ìƒ ì˜¤ë˜ëœ ì´ìŠˆ ì–¸ê¸‰ ("ì‘ë…„ì—...", "ì§€ë‚œí•´...", "ì˜ˆì „ì—...")
- âŒ ë§‰ì—°í•œ ë¯¸ë˜ ("ì–¸ì  ê°€", "ë‚˜ì¤‘ì—", "ì¡°ë§Œê°„")

âœ… í•„ìˆ˜ íŒ¨í„´ (ì •ë³´ ì œê³µ + ì§ˆë¬¸):
1. ìµœê·¼ ë‰´ìŠ¤/ì´ë²¤íŠ¸ ì–¸ê¸‰ (3ê°œì›” ì´ë‚´) + ì˜ê²¬ ì§ˆë¬¸
2. êµ¬ì²´ì ì¸ í–¥í›„ ì¼ì •/í”„ë¡œì íŠ¸ ì–¸ê¸‰ + ì§„í–‰ ìƒí™© ì§ˆë¬¸
3. ì—…ê³„ ìµœì‹  ë™í–¥/í†µê³„ ì œì‹œ + íšŒì‚¬ ëŒ€ì‘ ì§ˆë¬¸
4. ê´€ì‹¬ì‚¬ ê´€ë ¨ ìµœê·¼ ì •ë³´ + ê°œì¸ ì˜ê²¬ ì§ˆë¬¸

â° ì‹œê°„ í‘œí˜„ ê°€ì´ë“œ:
- âœ… ê³¼ê±°: "ì´ë²ˆ ì£¼", "ì§€ë‚œì£¼", "ì´ë²ˆ ë‹¬", "ì§€ë‚œë‹¬", "ìµœê·¼", "ìš”ì¦˜"
- âœ… ë¯¸ë˜: "ë‹¤ìŒ ì£¼", "ë‹¤ìŒ ë‹¬", "ë‹¤ìŒ ë¶„ê¸°", "ì—°ë§", "ë‚´ë…„ ì´ˆ", "ê³§"
- âŒ ê³¼ê±°: "ì‘ë…„", "ì§€ë‚œí•´", "ëª‡ ë…„ ì „", "ì˜ˆì „ì—"
- âŒ ë¯¸ë˜: "ì–¸ì  ê°€", "ì¡°ë§Œê°„", "ë‚˜ì¤‘ì—"

ìƒì„± ì˜ˆì‹œ:

1. íšŒì‚¬/ì‚¬ì—… ê´€ë ¨ (40-50%):
   âŒ ë‚˜ìœ ì˜ˆ: "{company}ì˜ ì‹ ì‚¬ì—…ì€ ì–´ë–»ê²Œ ë˜ì–´ê°€ë‚˜ìš”?"
   âŒ ë‚˜ìœ ì˜ˆ: "ì‘ë…„ì— ë°œí‘œí•˜ì‹  í”„ë¡œì íŠ¸ëŠ” ì–´ë–»ê²Œ ë˜ì…¨ë‚˜ìš”?"
   âœ… ì¢‹ì€ ì˜ˆ: "{company}ì—ì„œ ì´ë²ˆ ì£¼ ë°œí‘œí•˜ì‹  AI ê¸°ë°˜ ë¬¼ë¥˜ ì‹œìŠ¤í…œì´ ì—…ê³„ì—ì„œ ì£¼ëª©ë°›ê³  ìˆë˜ë°ìš”. ë‚´ë¶€ì ìœ¼ë¡œëŠ” ì–´ë–¤ ë°˜ì‘ì´ì‹ ê°€ìš”? ë‹¤ìŒ ë‹¬ ì‹œë²” ìš´ì˜ ì¼ì •ë„ ì¡íˆì…¨ë‚˜ìš”?"
   - category: "company"
   - ì‹œê°„: "ì´ë²ˆ ì£¼ ë°œí‘œ", "ë‹¤ìŒ ë‹¬ ì‹œë²” ìš´ì˜" (êµ¬ì²´ì ì´ê³  ìµœê·¼/ê°€ê¹Œìš´ ë¯¸ë˜)
   - êµ¬ì²´ì  ì‚¬ì‹¤: "AI ê¸°ë°˜ ë¬¼ë¥˜ ì‹œìŠ¤í…œ", "ì—…ê³„ ì£¼ëª©"
   - ìì—°ìŠ¤ëŸ¬ìš´ ì§ˆë¬¸: "ë‚´ë¶€ ë°˜ì‘", "ì‹œë²” ìš´ì˜ ì¼ì •"

2. ì‚°ì—…/ì—…ì¢… íŠ¸ë Œë“œ (30-40%):
   âŒ ë‚˜ìœ ì˜ˆ: "ìš”ì¦˜ AIê°€ í™”ë‘ì¸ë° ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?"
   âŒ ë‚˜ìœ ì˜ˆ: "ëª‡ ë…„ ì „ë¶€í„° AIê°€ ë°œì „í•˜ê³  ìˆëŠ”ë°..."
   âœ… ì¢‹ì€ ì˜ˆ: "ì§€ë‚œì£¼ OpenAIì—ì„œ ìƒˆë¡œìš´ GPT-4o ëª¨ë¸ì„ ì¶œì‹œí–ˆê³ , ì´ë²ˆ ë‹¬ êµ­ë‚´ ì£¼ìš” ê¸°ì—…ë“¤ì´ ë„ì…ì„ ê²€í†  ì¤‘ì´ë¼ê³  í•˜ë”ë¼ê³ ìš”. {company}ì—ì„œë„ 4ë¶„ê¸° ë‚´ AI ë„ì… ê³„íšì´ ìˆìœ¼ì‹ ì§€ ê¶ê¸ˆí•©ë‹ˆë‹¤."
   - category: "industry"
   - ì‹œê°„: "ì§€ë‚œì£¼ ì¶œì‹œ", "ì´ë²ˆ ë‹¬ ê²€í† ", "4ë¶„ê¸° ë‚´" (ìµœê·¼ & ê°€ê¹Œìš´ ë¯¸ë˜)
   - êµ¬ì²´ì  ì •ë³´: "GPT-4o ëª¨ë¸", "êµ­ë‚´ ì£¼ìš” ê¸°ì—… ë„ì… ê²€í† "
   - íšŒì‚¬ ì—°ê²°: "ê·€ì‚¬ ë„ì… ê³„íš"

3. ì•¡ì…˜/í”„ë¡œì íŠ¸ ê´€ë ¨ (í–¥í›„ ì¼ì • ìµœìš°ì„ ):
   âŒ ë‚˜ìœ ì˜ˆ: "ì§€ë‚œë²ˆ ë§ì”€í•˜ì‹  í”„ë¡œì íŠ¸ëŠ” ì–´ë–»ê²Œ ë˜ì…¨ë‚˜ìš”?"
   âŒ ë‚˜ìœ ì˜ˆ: "ì˜ˆì „ì— ë…¼ì˜í–ˆë˜ ë‚´ìš©ì€..."
   âœ… ì¢‹ì€ ì˜ˆ: "ì˜ê´‘êµ°ì²­ ë””ì§€í„¸ íŠ¸ìœˆ êµ¬ì¶• í”„ë¡œì íŠ¸ê°€ ë‹¤ìŒ ì£¼ ëª©ìš”ì¼ ì˜¤í›„ 2ì‹œ í‚¥ì˜¤í”„ ë¯¸íŒ…ìœ¼ë¡œ ì•Œê³  ìˆìŠµë‹ˆë‹¤. ì „ìš©íšŒì„  ì‹ ì²­ì€ ì´ë²ˆ ì£¼ ê¸ˆìš”ì¼ê¹Œì§€ ì™„ë£Œí•˜ì‹œëŠ” ê²Œ ì¢‹ì„ ê²ƒ ê°™ì€ë°, ì œê°€ ë¹ ë¥¸ ì²˜ë¦¬ ë„ì™€ë“œë¦´ê¹Œìš”?"
   - category: "company"
   - ì‹œê°„: "ë‹¤ìŒ ì£¼ ëª©ìš”ì¼ ì˜¤í›„ 2ì‹œ", "ì´ë²ˆ ì£¼ ê¸ˆìš”ì¼ê¹Œì§€" (ë§¤ìš° êµ¬ì²´ì ì¸ í–¥í›„ ì¼ì •)
   - êµ¬ì²´ì  ì •ë³´: "ë””ì§€í„¸ íŠ¸ìœˆ êµ¬ì¶•", "í‚¥ì˜¤í”„ ë¯¸íŒ…", "ì „ìš©íšŒì„  ì‹ ì²­"
   - ì‹¤ì§ˆì  ì œì•ˆ: "ë¹ ë¥¸ ì²˜ë¦¬ ì§€ì›"

4. ê°œì¸ ê´€ì‹¬ì‚¬ (10-20%, interests ìˆì„ ë•Œë§Œ):
   âŒ ë‚˜ìœ ì˜ˆ: "ê³¨í”„ ì¢‹ì•„í•˜ì‹ ë‹¤ê³  ë“¤ì—ˆëŠ”ë° ìš”ì¦˜ë„ ì¹˜ì‹œë‚˜ìš”?"
   âŒ ë‚˜ìœ ì˜ˆ: "ì‘ë…„ì— ê³¨í”„ ì¹˜ì‹œë˜ë°..."
   âœ… ì¢‹ì€ ì˜ˆ: "ì§€ë‚œì£¼ PGA íˆ¬ì–´ì—ì„œ í•œêµ­ ì„ ìˆ˜ê°€ ë˜ ìš°ìŠ¹í–ˆë”ë¼ê³ ìš”. {contactName}ë‹˜ë„ ê³¨í”„ ì¦ê¸°ì‹ ë‹¤ê³  ë“¤ì—ˆëŠ”ë°, ì´ë²ˆ ì£¼ë§ ë‚ ì”¨ê°€ ì¢‹ë‹¤ëŠ”ë° ë¼ìš´ë”© ê³„íš ìˆìœ¼ì„¸ìš”?"
   - category: "personal"
   - ì‹œê°„: "ì§€ë‚œì£¼ ìš°ìŠ¹", "ì´ë²ˆ ì£¼ë§" (ìµœê·¼ ì‚¬ê±´ + ê°€ê¹Œìš´ ë¯¸ë˜)
   - êµ¬ì²´ì  ì •ë³´: "PGA íˆ¬ì–´", "í•œêµ­ ì„ ìˆ˜ ìš°ìŠ¹", "ë‚ ì”¨ ì¢‹ìŒ"
   - ê°œì¸ ì—°ê²°: "ê³¨í”„ ì¦ê¸°ì‹¬", "ì£¼ë§ ë¼ìš´ë”©"

5. ê³„ì ˆ/ì‹œì˜ì„± (10-20%):
   âŒ ë‚˜ìœ ì˜ˆ: "ì—°ë§ì´ ë‹¤ê°€ì˜¤ë„¤ìš”. ì˜ ë§ˆë¬´ë¦¬í•˜ì„¸ìš”."
   âŒ ë‚˜ìœ ì˜ˆ: "ì‘ë…„ ì´ë§˜ë•ŒëŠ”..."
   âœ… ì¢‹ì€ ì˜ˆ: "ë‹¤ìŒ ë‹¬ ì´ˆë©´ 2025ë…„ ì˜ˆì‚° í™•ì • ì‹œì¦Œì¸ë°ìš”. ì§€ë‚œ 9ì›” ë¯¸íŒ… ë•Œ ë§ì”€í•˜ì…¨ë˜ ì¸í”„ë¼ í™•ì¶© ê±´ì´ ë‚´ë…„ ì˜ˆì‚°ì— ë°˜ì˜ë˜ì…¨ë‚˜ìš”? í•„ìš”í•˜ì‹œë©´ ì´ë²ˆ ì£¼ ë‚´ë¡œ ì œì•ˆì„œ ì—…ë°ì´íŠ¸ ìë£Œ ë³´ë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
   - category: "seasonal"
   - ì‹œê°„: "ë‹¤ìŒ ë‹¬ ì´ˆ", "ì§€ë‚œ 9ì›”", "ì´ë²ˆ ì£¼ ë‚´ë¡œ" (ê°€ê¹Œìš´ ë¯¸ë˜ ì¤‘ì‹¬, ìµœê·¼ 3ê°œì›” ê³¼ê±°)
   - êµ¬ì²´ì  ì •ë³´: "2025ë…„ ì˜ˆì‚° í™•ì •", "ì¸í”„ë¼ í™•ì¶© ê±´"
   - ì‹¤ì§ˆì  ì§€ì›: "ì œì•ˆì„œ ì—…ë°ì´íŠ¸ ìë£Œ", "ì´ë²ˆ ì£¼ ë‚´"

í•µì‹¬ ì›ì¹™:
1. ëª¨ë“  contentëŠ” ìµœì†Œ 2ë¬¸ì¥, 50ì ì´ìƒ
2. ì²« ë¬¸ì¥ì€ êµ¬ì²´ì ì¸ ì‚¬ì‹¤/ì •ë³´ ì œê³µ (ìµœê·¼ 3ê°œì›” ì´ë‚´)
3. ë‘ ë²ˆì§¸ ë¬¸ì¥ì€ ìì—°ìŠ¤ëŸ¬ìš´ ì§ˆë¬¸ ë˜ëŠ” ì œì•ˆ (í–¥í›„ ì¼ì • ì¤‘ì‹¬)
4. ì‹¤ì œ ëŒ€í™”ì—ì„œ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ìˆ˜ì¤€
5. ê³ ê°ì—ê²Œ ê°€ì¹˜ìˆëŠ” ì •ë³´ì™€ ì¸ì‚¬ì´íŠ¸ ì œê³µ
6. ì‹œê°„ í‘œí˜„ì€ í•­ìƒ êµ¬ì²´ì ìœ¼ë¡œ (ë‹¤ìŒ ì£¼ ì›”ìš”ì¼, ì´ë²ˆ ë‹¬ ë§, 4ë¶„ê¸° ë“±)`

/**
 * í´ë°± í…œí”Œë¦¿: OpenAI í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ì‚¬ìš©
 * 
 * ìˆ˜ì • ê°€ì´ë“œ:
 * - ë” ë‹¤ì–‘í•œ í´ë°± ì˜µì…˜ ì¶”ê°€ ê°€ëŠ¥
 * - ê³„ì ˆë³„, ìƒí™©ë³„ í´ë°± í…œí”Œë¦¿ ë¶„ë¦¬ ê°€ëŠ¥
 */
export const FALLBACK_TEMPLATES = (contactName: string, companyName: string) => [
  {
    topic: 'íšŒì‚¬ ê·¼í™©',
    content: `${companyName}ì—ì„œ ì´ë²ˆ ë¶„ê¸° ì¤‘ì  ì¶”ì§„ ì¤‘ì´ì‹  í”„ë¡œì íŠ¸ê°€ ìˆìœ¼ì‹¤ ê²ƒ ê°™ì€ë°ìš”. í˜¹ì‹œ ì €í¬ ìª½ì—ì„œ ì§€ì› ê°€ëŠ¥í•œ ë¶€ë¶„ì´ ìˆì„ê¹Œìš”?`,
    expire_days: 10,
  },
  {
    topic: 'ì—…ê³„ ë™í–¥',
    content: `ìµœê·¼ ì—…ê³„ì—ì„œ ë””ì§€í„¸ ì „í™˜ì´ ê°€ì†í™”ë˜ê³  ìˆë‹¤ëŠ” ê¸°ì‚¬ë¥¼ ë´¤ìŠµë‹ˆë‹¤. ${companyName}ì—ì„œëŠ” ì–´ë–¤ ë°©í–¥ìœ¼ë¡œ ì¤€ë¹„í•˜ê³  ê³„ì‹ ê°€ìš”?`,
    expire_days: 10,
  },
  {
    topic: 'ì‹œì¦Œ ë§ˆë¬´ë¦¬',
    content: `ì˜¬í•´ë„ 2ê°œì›” ë‚¨ì§“ ë‚¨ì•˜ëŠ”ë°ìš”. ${contactName}ë‹˜, ì˜¬í•´ ëª©í‘œí•˜ì…¨ë˜ ë¶€ë¶„ë“¤ ì˜ ë§ˆë¬´ë¦¬ë˜ê³  ê³„ì‹ ê°€ìš”? ì—°ë§ ì „ì— ì§€ì› í•„ìš”í•˜ì‹  ë¶€ë¶„ ìˆìœ¼ì‹œë©´ ë§ì”€í•´ ì£¼ì„¸ìš”.`,
    expire_days: 14,
  },
  {
    topic: 'ì—…ë¬´ í˜‘ë ¥',
    content: `ì§€ë‚œë²ˆ ë¯¸íŒ… ë•Œ ë§ì”€í•˜ì‹  ë‚´ìš© ì˜ ê²€í† í•´ë´¤ìŠµë‹ˆë‹¤. ë‹¤ìŒ ì£¼ì¯¤ í•œ ë²ˆ ë” ëµ™ê³  êµ¬ì²´ì ìœ¼ë¡œ ë…¼ì˜ë“œë¦¬ë©´ ì–´ë–¨ê¹Œìš”?`,
    expire_days: 7,
  },
]

/**
 * OpenAI ìƒì„± ì„¤ì •
 */
export const GENERATION_CONFIG = {
  model: 'gpt-4o-mini',
  temperature: 0.6, // 0.0 ~ 1.0: ë†’ì„ìˆ˜ë¡ ì°½ì˜ì , ë‚®ì„ìˆ˜ë¡ ì¼ê´€ì 
  // maxTokens: 500, // í•„ìš”ì‹œ ì£¼ì„ í•´ì œ
}

/**
 * í”„ë¡¬í”„íŠ¸ ë¹Œë”: ì‹¤ì œ ë°ì´í„°ë¥¼ í…œí”Œë¦¿ì— ì£¼ì…
 */
export function buildUserPrompt(
  contact: any,
  recentCalls: any[],
  recentActions: any[],
  recommendedProducts?: any[]
): string {
  const currentDate = new Date().toLocaleDateString('ko-KR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    weekday: 'long'
  })

  const contactInfo = `
Name: ${contact.name}
Company: ${contact.company || 'N/A'}
Position: ${contact.position || 'N/A'}
Last Contact: ${contact.last_contact || 'N/A'}
`

  const interests = contact.interests 
    ? `\nPersonal Interests: ${contact.interests}\n(ì´ ê´€ì‹¬ì‚¬ë¥¼ í™œìš©í•˜ì—¬ ê°œì¸ì  ì¹œë°€ê°ì„ í˜•ì„±í•  ìˆ˜ ìˆëŠ” ì†Œì¬ 1-2ê°œ í¬í•¨)` 
    : ''

  const callHistory = recentCalls && recentCalls.length > 0
    ? `\nRecent Calls:\n${recentCalls.map(c => `- ${c.created_at}: ${c.summary}`).join('\n')}`
    : ''

  const actionHistory = recentActions && recentActions.length > 0
    ? `\nRecent Actions:\n${recentActions.map(a => `- ${a.action_date}: ${a.description}`).join('\n')}`
    : ''

  const productRecommendations = recommendedProducts && recommendedProducts.length > 0
    ? `\n\nğŸ›ï¸ ì¶”ì²œ ìƒí’ˆ ì •ë³´:\n${recommendedProducts.map((p, index) => 
        `${index + 1}. ${p.name}\n   - ì„¤ëª…: ${p.description || 'ì •ë³´ ì—†ìŒ'}\n   - ì¹´í…Œê³ ë¦¬: ${p.category}\n   - ê°€ê²©: ${p.price ? `${p.price.toLocaleString()}${p.currency || 'KRW'}` : 'ë¬¸ì˜'}\n   - ì˜ì—… ë©˜íŠ¸: ${p.sales_pitch || 'ì €í¬ ì œí’ˆì„ ì†Œê°œë“œë¦¬ê³  ì‹¶ìŠµë‹ˆë‹¤.'}`
      ).join('\n\n')}\n\nìœ„ ìƒí’ˆë“¤ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì†Œê°œí•  ìˆ˜ ìˆëŠ” ì¶”ê°€ ìŠ¤ëª°í† í¬ ì†Œì¬ë„ 1-2ê°œ ìƒì„±í•´ì£¼ì„¸ìš”. ìƒí’ˆ ê´€ë ¨ ì†Œì¬ëŠ” categoryë¥¼ "product"ë¡œ ì„¤ì •í•˜ê³ , ê°•ìš”í•˜ì§€ ë§ê³  ìì—°ìŠ¤ëŸ½ê²Œ ì†Œê°œí•˜ì„¸ìš”.`
    : ''

  return USER_PROMPT_TEMPLATE
    .replace('{currentDate}', currentDate)
    .replace('{contactInfo}', contactInfo)
    .replace('{interests}', interests)
    .replace('{callHistory}', callHistory)
    .replace('{actionHistory}', actionHistory)
    .replace('{company}', contact.company || 'í•´ë‹¹ íšŒì‚¬')
    .replace('{position}', contact.position || 'ë‹´ë‹¹ì') + productRecommendations
}
