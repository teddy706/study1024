{
  "name": "Business Contacts Dashboard",
  "dataSources": {
    "supabaseApi": {
      "type": "restapi",
      "config": {
        "baseUrl": "{{process.env.SUPABASE_URL}}",
        "headers": {
          "apikey": "{{process.env.SUPABASE_ANON_KEY}}",
          "Authorization": "Bearer {{process.env.SUPABASE_ANON_KEY}}"
        }
      }
    }
  },
  "queries": {
    "fetchContacts": {
      "type": "restapi",
      "source": "supabaseApi",
      "method": "GET",
      "endpoint": "/rest/v1/business_cards",
      "headers": {
        "Range": "0-99",
        "Prefer": "count=exact"
      },
      "params": {
        "select": "*",
        "order": "created_at.desc"
      }
    },
    "searchContacts": {
      "type": "restapi",
      "source": "supabaseApi",
      "method": "GET",
      "endpoint": "/rest/v1/business_cards",
      "params": {
        "select": "*",
        "or": "extracted_info->name.ilike.%{{searchInput.value}}%,extracted_info->company.ilike.%{{searchInput.value}}%",
        "order": "created_at.desc"
      }
    },
    "generateReport": {
      "type": "restapi",
      "source": "supabaseApi",
      "method": "GET",
      "endpoint": "/rest/v1/business_cards",
      "params": {
        "select": "created_at,extracted_info,summary,sentiment_score",
        "created_at": "gte.{{startDate.value}}",
        "order": "created_at.desc"
      }
    },
    "fetchCalendarEvents": {
      "type": "restapi",
      "source": "supabaseApi",
      "method": "GET",
      "endpoint": "/rest/v1/calendar_events",
      "params": {
        "select": "*",
        "date": "gte.{{startOfWeek.value}}",
        "order": "date.asc,time.asc"
      }
    }
  },
  "components": {
    "mainContainer": {
      "type": "tabs",
      "tabs": [
        {
          "label": "연락처",
          "id": "contacts",
          "icon": "user",
          "content": {
            "type": "container",
            "components": [
              {
                "type": "textInput",
                "id": "searchInput",
                "label": "연락처 검색",
                "placeholder": "이름 또는 회사명으로 검색",
                "onChange": "{{searchContacts.trigger()}}"
              },
              {
                "type": "table",
                "data": "{{fetchContacts.data}}",
                "columns": [
                  {
                    "id": "name",
                    "title": "이름",
                    "value": "{{item.extracted_info.name}}"
                  },
                  {
                    "id": "company",
                    "title": "회사",
                    "value": "{{item.extracted_info.company}}"
                  },
                  {
                    "id": "title",
                    "title": "직함",
                    "value": "{{item.extracted_info.title}}"
                  },
                  {
                    "id": "phone",
                    "title": "연락처",
                    "value": "{{item.extracted_info.phone}}"
                  },
                  {
                    "id": "email",
                    "title": "이메일",
                    "value": "{{item.extracted_info.email}}"
                  },
                  {
                    "id": "actions",
                    "title": "작업",
                    "template": "button-group",
                    "buttons": [
                      {
                        "label": "상세",
                        "icon": "eye",
                        "onClick": "{{openModal('contactDetail', item)}}"
                      },
                      {
                        "label": "통화",
                        "icon": "phone",
                        "onClick": "{{openModal('newCall', item)}}"
                      },
                      {
                        "label": "일정",
                        "icon": "calendar",
                        "onClick": "{{openModal('newEvent', item)}}"
                      }
                    ]
                  }
                ]
              }
            ]
          }
        },
        {
          "label": "보고서",
          "id": "reports",
          "icon": "file-text",
          "content": {
            "type": "container",
            "components": [
              {
                "type": "dateRangePicker",
                "id": "reportDateRange",
                "label": "기간 선택",
                "onChange": "{{generateReport.trigger()}}"
              },
              {
                "type": "chart",
                "title": "일별 연락처 추가 현황",
                "chartType": "bar",
                "data": "{{generateReport.data}}",
                "config": {
                  "x": "created_at",
                  "y": "count",
                  "groupBy": "company"
                }
              },
              {
                "type": "chart",
                "title": "업종별 분포",
                "chartType": "pie",
                "data": "{{generateReport.data}}",
                "config": {
                  "value": "count",
                  "label": "industry"
                }
              },
              {
                "type": "stats",
                "items": [
                  {
                    "label": "총 연락처",
                    "value": "{{generateReport.data.length}}"
                  },
                  {
                    "label": "평균 감성점수",
                    "value": "{{average(generateReport.data, 'sentiment_score')}}"
                  }
                ]
              }
            ]
          }
        },
        {
          "label": "통화",
          "id": "calls",
          "icon": "phone",
          "content": {
            "type": "container",
            "components": [
              {
                "type": "button",
                "label": "통화 기록 추가",
                "icon": "plus",
                "onClick": "{{openModal('newCall')}}"
              },
              {
                "type": "table",
                "data": "{{fetchCalls.data}}",
                "columns": [
                  {
                    "id": "date",
                    "title": "날짜",
                    "value": "{{formatDate(item.date, 'YYYY-MM-DD')}}"
                  },
                  {
                    "id": "contact",
                    "title": "연락처",
                    "value": "{{item.contact_name}}"
                  },
                  {
                    "id": "duration",
                    "title": "통화시간",
                    "value": "{{formatDuration(item.duration)}}"
                  },
                  {
                    "id": "notes",
                    "title": "메모",
                    "value": "{{item.notes}}"
                  }
                ]
              }
            ]
          }
        },
        {
          "label": "일정",
          "id": "calendar",
          "icon": "calendar",
          "content": {
            "type": "container",
            "components": [
              {
                "type": "calendar",
                "events": "{{fetchCalendarEvents.data.map(e => ({title: e.title, start: e.date + 'T' + e.time, contact: e.contact_name, notes: e.notes}))}}"
              },
              {
                "type": "list",
                "title": "다가오는 일정",
                "data": "{{fetchCalendarEvents.data.filter(e => new Date(e.date + 'T' + e.time) > new Date()).slice(0, 5)}}",
                "itemTemplate": [
                  {
                    "type": "text",
                    "value": "{{item.title}}",
                    "style": "heading"
                  },
                  {
                    "type": "text",
                    "value": "{{formatDate(item.date, 'M월 D일')}} {{item.time}}",
                    "style": "subtext"
                  },
                  {
                    "type": "text",
                    "value": "{{item.contact_name}}",
                    "style": "subtext"
                  }
                ]
              }
            ]
          }
        }
      ]
    }
  },
  "modals": {
    "contactDetail": {
      "title": "연락처 상세정보",
      "components": {
        "type": "container",
        "style": "card",
        "components": [
          {
            "type": "image",
            "src": "{{modal.data.image_path}}"
          },
          {
            "type": "keyValue",
            "items": [
              {
                "key": "이름",
                "value": "{{modal.data.extracted_info.name}}"
              },
              {
                "key": "회사",
                "value": "{{modal.data.extracted_info.company}}"
              },
              {
                "key": "직함",
                "value": "{{modal.data.extracted_info.title}}"
              },
              {
                "key": "연락처",
                "value": "{{modal.data.extracted_info.phone}}"
              },
              {
                "key": "이메일",
                "value": "{{modal.data.extracted_info.email}}"
              },
              {
                "key": "주소",
                "value": "{{modal.data.extracted_info.address}}"
              }
            ]
          },
          {
            "type": "text",
            "label": "AI 요약",
            "value": "{{modal.data.summary}}"
          }
        ]
      }
    }
  }
}